const u=navigator.userAgentconst isAndroid=u.indexOf('Android')>-1||u.indexOf('Adr')>-1const isIOS=!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)const isWX=u.toLowerCase().match(/MicroMessenger/i)=="micromessenger";const andoirFunction=(callback)=>{if(window.WebViewJavascriptBridge){callback(window.WebViewJavascriptBridge)}else{document.addEventListener('WebViewJavascriptBridgeReady',function(){callback(window.WebViewJavascriptBridge)},false)}}const iosFuntion=(callback)=>{if(window.WebViewJavascriptBridge){return callback(WebViewJavascriptBridge)}if(window.WVJBCallbacks){return window.WVJBCallbacks.push(callback)}window.WVJBCallbacks=[callback];if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.iOS_Native_InjectJavascript){window.webkit.messageHandlers.iOS_Native_InjectJavascript.postMessage(null)}else{window.WVJBCallbacks=[callback]var WVJBIframe=document.createElement('iframe')WVJBIframe.style.display='none'WVJBIframe.src='wvjbscheme://__BRIDGE_LOADED__'document.documentElement.appendChild(WVJBIframe)setTimeout(function(){document.documentElement.removeChild(WVJBIframe)},0)}}window.setupWebViewJavascriptBridge=isAndroid?andoirFunction:iosFuntion if(!isWX){if(isAndroid){window.setupWebViewJavascriptBridge(function(bridge){bridge.init(function(msg,responseCallback){responseCallback(msg)})})}else{window.setupWebViewJavascriptBridge()}}const TIME_OUT=2000function wbBridgeSetup(name,callback){window.setupWebViewJavascriptBridge(bridge=>{bridge.registerHandler(name,(data='')=>{try{data=JSON.parse(data)}catch(err){}callback&&callback(data)})})}function toJson(obj){if(obj&&typeof obj!=='string'){obj=JSON.stringify(obj)}return obj}function appBridge(name,params,timeout=TIME_OUT){let unresolved=trueconst{version}={version:'2.1.1'}const _v=+version.replace(/\./g,'')console.log(1111,_v)if(_v>=211){params=toJson(params)}else{if(!isIOS){params=toJson(params)}}return new Promise((resolve,reject)=>{const callback=data=>{console.error('=====>',data)try{data=JSON.parse(data)}catch(err){}unresolved=false console.info(`app指令${name}返回`,data)return resolve(data)}window.setupWebViewJavascriptBridge(bridge=>{console.warn('调取app指令',name,params)bridge.callHandler(name,params,callback)})if(timeout){setTimeout(()=>{unresolved&&resolve()},timeout)}})}window.app=(name,params)=>{window.setupWebViewJavascriptBridge(bridge=>{console.warn('调取app指令',name,params)bridge.callHandler(name,params,data=>{try{data=JSON.parse(data)}catch(err){}console.error('返回数据 ===>',data)})})}function popSocialMenu(data){return appBridge('pop_social_menu',data)}(function(window){const command={popSocialMenu}window.command=command}(this))